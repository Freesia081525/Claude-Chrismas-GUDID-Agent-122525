這是一份經過深度重組、擴充並專業化的技術規格書。內容整合了您提供的 GUDID 原型架構與 TUDID 擴充計畫，針對台灣衛生福利部食品藥物管理署 (TFDA) 的需求情境進行了在地化與法規對接，字數約 3500-4000 字，包含 10 個詳細表格。

---

# 醫療器材單一識別系統資訊平台 (TUDID) 資料品質 AI 多代理分析系統技術規格書

**文件版本：** 2.0 (正式提案版)
**日期：** 2024-05-23
**專案代號：** TFDA-TUDID-AI-2024
**文件語言：** 繁體中文 (Traditional Chinese)

---

## 1. 專案概述 (Project Overview)

### 1.1 背景與政策脈絡
依據「醫療器材標籤應刊載單一識別碼規定」及相關法規，醫療器材許可證所有人或登載者，應於產品市面流通前，至 UDID 平臺登載 DI (Device Identifier) 及對應資料。台灣食藥署 (TFDA) 建置之 TUDID 平台旨在接軌國際（如美國 FDA GUDID、歐盟 EUDAMED），強化上市後監管與不良事件追溯。

然而，隨著登錄資料量指數級增長，資料品質面臨嚴峻挑戰，包括欄位缺漏、格式錯誤、邏輯不一致及描述模糊等問題。傳統的人工審查難以負荷龐大的資料檢核需求。本計畫旨在導入 **大型語言模型 (LLM)** 與 **多代理人 (Multi-Agent)** 技術，建置一套自動化資料品質分析系統，並規劃為期一年的 **Sandbox 試辦計畫**，在確保資安與合規的前提下，驗證 AI 輔助審查的可行性。

### 1.2 系統目的
本系統將建構一個「TUDID 資料品質多代理 AI 分析平台」，透過模擬不同領域專家（如法規專員、風險控管師、醫學術語專家）的 AI 代理人，自動化執行以下任務：
1.  **結構化檢核**：驗證 UDI 格式、日期邏輯、必填欄位完整性。
2.  **語意分析**：檢查產品描述、預期用途與許可證內容的一致性。
3.  **風險評估**：計算資料品質風險分數，輔助審查人員進行決策。
4.  **視覺化報告**：提供直觀的儀表板，揭露資料集整體的健康狀況。

### 1.3 專案名詞定義

**表 1：專案名詞定義表**

| 名詞 (Term) | 定義 (Definition) |
| :--- | :--- |
| **TUDID** | 台灣醫療器材單一識別系統資訊平台 (Taiwan Unique Device Identification Database)。 |
| **UDI-DI** | 醫療器材單一識別碼之產品識別碼 (Device Identifier)。 |
| **Multi-Agent System** | 多代理人系統，指多個專職的 AI 模組協同工作，各自負責特定的檢核任務。 |
| **Sandbox** | 沙盒環境，指與正式生產環境隔離的測試區域，用於驗證新技術與流程。 |
| **LLM** | 大型語言模型 (Large Language Model)，如 Gemini, GPT-4, Claude 等。 |
| **RAG** | 檢索增強生成 (Retrieval-Augmented Generation)，結合外部知識庫增強 AI 準確度。 |
| **Human-in-the-loop** | 人機協作機制，強調 AI 提供建議，最終決策權保留於審查人員。 |

---

## 2. 適用法規與標準 (Regulations & Standards)

本系統之設計與運作需嚴格遵循台灣醫療器材相關法規及資通安全標準。

**表 2：適用法規與標準清單**

| 類別 | 法規/標準名稱 | 關聯性說明 |
| :--- | :--- | :--- |
| **核心法規** | 醫療器材管理法 | 定義醫療器材管理之母法，規範登錄義務。 |
| **核心法規** | 醫療器材標籤應刊載單一識別碼規定 | 規範 UDI 編碼、標示及 TUDID 登載項目之具體要求。 |
| **資安標準** | 資通安全管理法 | 規範公務機關系統之資安等級、防護基準及通報機制。 |
| **隱私保護** | 個人資料保護法 | 雖 TUDID 多為產品資料，但 Sandbox 若涉及廠商聯絡人資訊需遵從此法。 |
| **國際標準** | ISO 13485 / IMDRF UDI Guidance | 系統邏輯需參考國際醫療器材監管論壇之 UDI 指引。 |
| **資料交換** | HL7 SPL / FHIR | 預留未來與國際資料庫或醫院系統交換資料之標準格式。 |

---

## 3. 系統架構設計 (System Architecture)

### 3.1 架構設計原則
本系統採用 **單頁應用程式 (SPA)** 結合 **Serverless 概念** 的混合架構。在 Sandbox 試辦階段，為降低部署複雜度與資料外洩風險，核心邏輯優先於用戶端或受控的容器環境中執行。

### 3.2 系統邏輯架構圖
```mermaid
graph TD
    User[TFDA 審查人員/業者] -->|操作 UI| FE[前端介面層 (React/Streamlit)]
    FE -->|狀態管理| State[Session State Manager]
    State -->|調度指令| Orchestrator[代理人調度核心]
    
    subgraph "AI 多代理服務層"
        Orchestrator --> AgentA[結構檢核代理]
        Orchestrator --> AgentB[法規一致性代理]
        Orchestrator --> AgentC[風險評分代理]
        Orchestrator --> AgentD[語意分析代理]
    end
    
    subgraph "外部服務與數據"
        AgentA & AgentB & AgentC & AgentD -->|API 請求 (匿名化)| LLM_API[LLM Gateway (Gemini/OpenAI)]
        AgentB -->|檢索| VectorDB[法規向量資料庫 (RAG)]
    end
    
    LLM_API -->|JSON 回應| Orchestrator
    Orchestrator -->|整合結果| FE
```

### 3.3 技術堆疊 (Tech Stack)

**表 3：關鍵技術堆疊規格表**

| 層級 | 技術組件 | 版本/規格 | 選擇理由 |
| :--- | :--- | :--- | :--- |
| **前端框架** | React 18+ 或 Streamlit | 最新穩定版 | React 適合高度客製化；Streamlit 適合快速原型開發與數據展示。 |
| **程式語言** | TypeScript / Python | TS 5.0+ / Py 3.10+ | TypeScript 用於前端邏輯確保型別安全；Python 用於資料處理。 |
| **樣式庫** | Tailwind CSS | v3.4+ | Utility-first 架構，支援 RWD 與深色模式，開發效率高。 |
| **AI 介接** | LangChain / Google GenAI SDK | 最新版 | 封裝 LLM 呼叫，支援 Prompt Template 與 Chain 管理。 |
| **圖表視覺化** | Recharts / Apache ECharts | - | 支援互動式數據圖表，適合呈現風險分佈與統計數據。 |
| **資料儲存** | In-memory DataFrame | Pandas / State | 試辦階段不落地資料庫，降低資安風險，資料僅存於 Session。 |

---

## 4. 軟體需求規格 (SRS) - 功能性需求

### 4.1 資料集管理模組
**FR-01 資料匯入：** 系統需支援 CSV 與 JSON 格式之 TUDID 資料匯入，並具備編碼自動偵測 (UTF-8/Big5) 功能。
**FR-02 資料預覽與編輯：** 系統應提供類似 Excel 的線上編輯器 (Data Grid)，允許使用者在 AI 分析前/後手動修正資料，支援分頁顯示 (Pagination) 以處理大量數據。
**FR-03 模擬資料生成：** 系統應內建符合 TUDID 欄位規範的「合成資料 (Synthetic Data)」產生器，供教學演示與系統測試使用。

### 4.2 多代理人配置模組
**FR-04 代理人定義檔：** 系統應讀取 `agents.yaml` 設定檔以動態載入代理人列表。
**FR-05 代理人開關與參數：** 使用者可於介面上啟用/停用特定代理人，並調整其模型參數 (如 Temperature, Max Tokens) 及 System Prompt。
**FR-06 模型選擇：** 支援多模型切換 (Switchable Models)，如 Gemini 1.5 Pro 用於複雜推理，Gemini Flash 用於快速檢核。

**表 4：核心代理人 (Core Agents) 功能定義**

| 代理人 ID | 名稱 | 核心職責 | 輸入資料 | 輸出產物 |
| :--- | :--- | :--- | :--- | :--- |
| `agent_struct` | **結構檢核員** | 檢查必填欄位、UDI 格式 (GS1/HIBCC)、日期邏輯。 | 原始 CSV 欄位 | 錯誤欄位清單、正規化建議。 |
| `agent_reg` | **法規合規員** | 比對產品分類分級與法規資料庫，檢查許可證字號格式。 | 許可證號、分類碼 | 合規性報告、違規法條引用。 |
| `agent_semantic` | **語意分析師** | 檢查「中文品名」、「英文品名」與「產品描述」的一致性。 | 文字描述欄位 | 語意矛盾點、優化建議。 |
| `agent_risk` | **風險鑑識官** | 綜合上述結果，計算該筆資料的「品質風險分數 (0-100)」。 | 其他代理輸出 | 風險等級 (高/中/低)、總評。 |
| `agent_translator` | **多語對照員** | 檢查中英文欄位翻譯是否精確，有無遺漏關鍵警語。 | 中/英描述 | 翻譯差異報告。 |

### 4.3 執行與分析核心
**FR-07 管線執行 (Pipeline Execution)：** 系統需支援「串列執行」與「平行執行」。部分代理 (如結構檢核) 先行，其輸出可作為後續代理 (如風險評分) 的輸入。
**FR-08 JSON 容錯解析：** 系統需具備強健的 JSON Parser，當 LLM 回傳格式不符時，自動觸發重試 (Retry) 或提取部分有效資訊，避免程式崩潰。
**FR-09 進度回饋：** 執行過程中需透過進度條 (Progress Bar) 與即時日誌 (Live Logs) 顯示當前處理的代理人與資料筆數。

**表 5：標準化 JSON 輸出格式規範**

| 欄位名稱 | 型別 | 說明 |
| :--- | :--- | :--- |
| `summary` | String | 該代理人的分析總結 (Markdown 格式)。 |
| `issues` | Array | 發現的問題列表。 |
| `issues[].id` | String | 問題唯一識別碼。 |
| `issues[].severity` | String | 嚴重程度 (Critical, High, Medium, Low)。 |
| `issues[].description` | String | 問題詳細描述。 |
| `issues[].suggestion` | String | AI 建議的修正方式。 |
| `metrics.risk_score` | Number | 0-100 的量化指標。 |

### 4.4 儀表板與視覺化
**FR-10 風險總覽：** 顯示本次分析的總體風險儀表板，包含嚴重程度圓餅圖 (Severity Distribution)。
**FR-11 代理人績效卡：** 以卡片式設計展示每個代理人的發現，支援展開/收合詳細問題清單。
**FR-12 互動式篩選：** 使用者可點擊「高風險」區塊，表格自動過濾出對應的異常資料列。

### 4.5 個人化與 UI/UX
**FR-13 多語系介面：** 支援繁體中文 (zh-TW) 與英文 (en-US) 切換。
**FR-14 畫家主題 (WOW UI)：** 內建 20 種藝術風格主題 (如 Monet, Van Gogh)，提供隨機切換功能，提升使用者體驗與趣味性。
**FR-15 AI 筆記小幫手：** 提供側邊欄筆記功能，AI 可自動摘要審查過程中的發現，生成會議紀錄草稿。

---

## 5. 非功能性需求 (NFR)

### 5.1 效能需求
**NFR-01 回應時間：** 前端介面載入時間需 < 2 秒；單筆資料的完整 AI 代理分析流程需在 30 秒內完成 (視外部 API 延遲而定)。
**NFR-02 併發處理：** 系統需支援批次處理 (Batch Processing)，單次上傳 100 筆資料時，應能背景執行而不凍結 UI。

### 5.2 安全性需求
**NFR-03 資料不落地：** 在 Sandbox 階段，上傳之資料僅存在於瀏覽器記憶體或臨時 Session 中，關閉分頁即銷毀。
**NFR-04 匿名化機制：** 傳送至 LLM API 前，系統需自動遮蔽敏感個資 (如聯絡人姓名、電話)，僅傳送產品相關資訊。
**NFR-05 API Key 管理：** 使用者端的 API Key 需加密存儲於 LocalStorage 或 SessionStorage，禁止明文傳輸。

**表 6：資安風險評估與緩解措施**

| 風險項目 | 風險等級 | 緩解措施 |
| :--- | :--- | :--- |
| **資料外洩** | 高 | 採用「資料最小化」原則，僅傳送必要欄位；實施自動去識別化。 |
| **Prompt Injection** | 中 | 在 System Prompt 中加入防護指令，限制 AI 僅能回答 TUDID 相關內容。 |
| **幻覺 (Hallucination)** | 中 | 實作 RAG 機制，要求 AI 引用具體法規條文；介面標示「AI 建議僅供參考」。 |
| **服務阻斷 (DoS)** | 低 | 實作 API Rate Limiting 與斷路器 (Circuit Breaker) 機制。 |

---

## 6. 一年期 Sandbox 試辦計畫 (One-Year Pilot Plan)

為確保系統順利導入 TFDA，本計畫規劃為期 12 個月的試辦階段，分為四個季度執行。

**表 7：Sandbox 試辦計畫時程表**

| 階段 | 時間跨度 | 關鍵任務 (Key Activities) | 交付成果 (Deliverables) |
| :--- | :--- | :--- | :--- |
| **Phase 1: 規劃與原型** | 第 1-3 個月 | 1. 成立工作小組 (TFDA/IT/法規)。<br>2. 確定 TUDID 測試資料集與匿名化規則。<br>3. 開發 PoC 原型 (核心 10 個代理)。 | 1. 需求規格書定稿。<br>2. 匿名化測試資料集。<br>3. PoC 系統 v0.5。 |
| **Phase 2: 內部測試** | 第 4-6 個月 | 1. TFDA 內部 5-10 位審查員試用。<br>2. 擴充代理至 20+ 個 (加入進階法規檢核)。<br>3. 優化 Prompt 與 UI/UX。 | 1. 內部試用回饋報告。<br>2. 系統 v1.0 (Beta)。<br>3. 代理人調校手冊。 |
| **Phase 3: 產業沙盒** | 第 7-9 個月 | 1. 邀請 10-20 家示範業者參與 Sandbox。<br>2. 舉辦教育訓練與說明會。<br>3. 收集業者端使用 AI 自檢工具的回饋。 | 1. 產業試辦報告。<br>2. 系統 v2.0 (Industry Ready)。<br>3. 操作教學影片。 |
| **Phase 4: 評估與擴展** | 第 10-12 個月 | 1. 綜合效益評估 (審查效率/資料品質提升率)。<br>2. 規劃與正式 TUDID 系統對接架構。<br>3. 研擬正式上線之資安與採購規範。 | 1. 試辦總結報告。<br>2. 正式系統建置建議書。<br>3. 國際研討會發表草案。 |

---

## 7. 硬體與資源需求 (Hardware & Resources)

### 7.1 試辦階段資源 (Sandbox)
**表 8：試辦階段硬體規格建議 (基於 VM 或 Container)**

| 資源項目 | 規格建議 | 說明 |
| :--- | :--- | :--- |
| **運算單元 (CPU)** | 4 vCPU | 處理前端渲染與 JSON 解析邏輯。 |
| **記憶體 (RAM)** | 16 GB - 32 GB | 需容納 In-memory DataFrame 與大量 Log 資訊。 |
| **儲存空間 (Disk)** | 100 GB SSD | 存放應用程式碼、Docker Image 及臨時日誌。 |
| **網路頻寬** | 100 Mbps (上下行) | 確保呼叫外部 LLM API 之低延遲。 |
| **LLM 預算** | 預估 Token 費用 | 需編列 API 使用費 (依使用量計價)。 |

### 7.2 部署策略
1.  **環境隔離：** 部署於 TFDA 內部測試區或政府雲 (T-Cloud) 的獨立 VPC，不直接連通正式資料庫。
2.  **存取控制：** 透過 IP 白名單或 VPN 限制僅有獲授權之試辦人員可存取 Web 介面。

---

## 8. 未來擴充路線圖 (Future Roadmap)

**表 9：功能演進規劃**

| 功能模組 | 短期 (試辦期) | 中期 (正式上線) | 長期 (AI 生態系) |
| :--- | :--- | :--- | :--- |
| **資料來源** | CSV 上傳、模擬資料 | TUDID 測試庫 API 介接 | 即時串流 (Kafka) 監控 |
| **AI 模型** | 公有雲 LLM (API) | 混合模式 (公有雲 + 本地小模型) | 私有化微調模型 (Local LLM) |
| **知識庫** | 內建 Prompt | RAG (檢索法規文件) | 動態法規知識圖譜 |
| **輸出報告** | 畫面顯示、JSON 下載 | PDF 正式報告、審查意見書草稿 | 自動化稽核履歷區塊鏈上鏈 |

---

## 9. 治理與風險管理 (Governance)

**表 10：AI 治理框架**

| 治理構面 | 管控機制 |
| :--- | :--- |
| **可解釋性 (XAI)** | 系統必須提供 AI 判斷的「引用來源」或「推理過程」，不能僅給出結果。 |
| **人機協作 (HITL)** | AI 僅提供「建議 (Suggestion)」，任何資料的修改與駁回皆需人工確認。 |
| **模型監控** | 定期評估代理人的準確率 (Recall/Precision)，避免模型漂移 (Model Drift)。 |
| **供應商管理** | 試辦期間評估不同 LLM 供應商 (Google, OpenAI, Anthropic) 的穩定性與合規性。 |

---

## 10. 附錄：20 個綜合後續問題 (Comprehensive Follow-up Questions)

為了確保專案順利推進並釐清潛在盲點，以下列出 20 個關鍵問題，建議 TFDA 與開發團隊進行深度研討：

### 法規與政策面
1.  **資料授權：** 在 Sandbox 階段，若業者上傳真實資料進行測試，是否需要簽署額外的資料授權或保密協議 (NDA)？
2.  **審查效力：** AI 系統產出的「合規性報告」在法律上是否具有參考效力？若 AI 誤判導致廠商損失，責任歸屬為何？
3.  **法規更新：** 當《醫療器材管理法》或 UDI 規範修訂時，AI 代理人的 Prompt 更新機制為何？是由 IT 人員還是法規人員維護？
4.  **國際對接：** 本系統的檢核邏輯是否需要與美國 FDA GUDID 或歐盟 EUDAMED 的規則保持同步？有無自動化同步機制？

### 技術與架構面
5.  **Token 限制：** 當 TUDID 資料欄位過多（例如包含長篇仿單文字）導致超出 LLM Token 限制時，系統的分段處理 (Chunking) 策略為何？
6.  **回應延遲：** 若單次批次上傳 1000 筆資料，預估處理時間可能長達數十分鐘，系統如何設計非同步通知 (Asynchronous Notification)？
7.  **幻覺控制：** 如何具體量化 AI 的「幻覺率」？是否導入「審查代理人 (Critic Agent)」進行二次驗證？
8.  **本地部署：** 考量長期資安，TFDA 是否計畫自行微調 (Fine-tune) 開源模型 (如 Llama 3) 並在地端運行，以完全阻絕資料出境？
9.  **API 成本：** 試辦期間的 Token 消耗量預估為何？是否有成本上限 (Budget Cap) 的熔斷機制？

### 資安與隱私面
10. **去識別化：** 針對「聯絡人資訊」或「專利技術描述」，系統的自動去識別化演算法準確率能達到多少？
11. **資料殘留：** 使用外部 LLM API (如 Google Gemini) 時，如何確保供應商不會將 TUDID 資料用於模型訓練？(需確認 Enterprise 條款)。
12. **存取軌跡：** 系統是否具備完整的稽核日誌 (Audit Log)，記錄誰在何時使用了哪個代理人分析了哪批資料？

### 營運與推廣面
13. **人員抗拒：** 內部審查人員可能擔心 AI 取代工作或增加學習負擔，有無具體的變革管理 (Change Management) 與教育訓練計畫？
14. **業者誘因：** 參與 Sandbox 的業者能獲得什麼實質誘因？(例如：優先審查、行政指導減免？)
15. **錯誤回饋：** 若使用者發現 AI 判斷錯誤，介面上有無快速回報機制 (Feedback Loop) 以利後續模型優化？
16. **多語系維護：** 系統 UI 與 Prompt 的多語系內容，是否由專人定期維護以確保專業術語的精確性？

### 未來展望
17. **擴充範圍：** 除了 TUDID，本系統架構是否可直接套用於「藥品查驗登記」或「食品追溯」系統？
18. **RAG 整合：** 何時導入 RAG 技術，讓 AI 能即時查詢 TFDA 的內部公告函文與 SOP？
19. **自動修正：** 未來是否考慮開放「一鍵自動修正」功能（由 AI 直接改寫資料庫），還是永遠保持「建議」模式？
20. **KPI 設定：** 試辦計畫成功的量化指標為何？(例如：資料錯誤率降低 30%、審查時間縮短 20%？)
